"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var pipwerks={UTILS:{},debug:{isActive:!0},SCORM:{version:null,handleCompletionStatus:!0,handleExitMode:!0,API:{handle:null,isFound:!1},connection:{isActive:!1},data:{completionStatus:null,exitStatus:null},debug:{}}};pipwerks.SCORM.isAvailable=function(){return!0},pipwerks.SCORM.API.find=function(e){for(var t=null,i=0,n="SCORM.API.find",s=pipwerks.UTILS.trace,r=pipwerks.SCORM;!e.API&&!e.API_1484_11&&e.parent&&e.parent!=e&&i<=500;)i++,e=e.parent;if(r.version)switch(r.version){case"2004":e.API_1484_11?t=e.API_1484_11:s(n+": SCORM version 2004 was specified by user, but API_1484_11 cannot be found.");break;case"1.2":e.API?t=e.API:s(n+": SCORM version 1.2 was specified by user, but API cannot be found.")}else e.API_1484_11?(r.version="2004",t=e.API_1484_11):e.API&&(r.version="1.2",t=e.API);return t?(s(n+": API found. Version: "+r.version),s("API: "+t)):s(n+": Error finding API. \nFind attempts: "+i+". \nFind attempt limit: 500"),t},pipwerks.SCORM.API.get=function(){var e=null,t=window,i=pipwerks.SCORM,n=i.API.find,s=pipwerks.UTILS.trace;return!(e=n(t))&&t.parent&&t.parent!=t&&(e=n(t.parent)),!e&&t.top&&t.top.opener&&(e=n(t.top.opener)),!e&&t.top&&t.top.opener&&t.top.opener.document&&(e=n(t.top.opener.document)),e?i.API.isFound=!0:s("API.get failed: Can't find the API!"),e},pipwerks.SCORM.API.getHandle=function(){var e=pipwerks.SCORM.API;return e.handle||e.isFound||(e.handle=e.get()),e.handle},pipwerks.SCORM.connection.initialize=function(){var e=!1,t=pipwerks.SCORM,i=t.data.completionStatus,n=pipwerks.UTILS.trace,s=pipwerks.UTILS.StringToBoolean,r=t.debug,o="SCORM.connection.initialize ";if(n("connection.initialize called."),t.connection.isActive)n(o+"aborted: Connection already active.");else{var a=t.API.getHandle(),c=0;if(a){switch(t.version){case"1.2":e=s(a.LMSInitialize(""));break;case"2004":e=s(a.Initialize(""))}if(e)if(null!==(c=r.getCode())&&0===c){if(t.connection.isActive=!0,t.handleCompletionStatus&&(i=t.status("get"))){switch(i){case"not attempted":case"unknown":t.status("set","incomplete")}t.save()}}else e=!1,n(o+"failed. \nError code: "+c+" \nError info: "+r.getInfo(c));else n(null!==(c=r.getCode())&&0!==c?o+"failed. \nError code: "+c+" \nError info: "+r.getInfo(c):o+"failed: No response from server.")}else n(o+"failed: API is null.")}return e},pipwerks.SCORM.connection.terminate=function(){var e=!1,t=pipwerks.SCORM,i=t.data.exitStatus,n=t.data.completionStatus,s=pipwerks.UTILS.trace,r=pipwerks.UTILS.StringToBoolean,o=t.debug,a="SCORM.connection.terminate ";if(t.connection.isActive){var c=t.API.getHandle(),p=0;if(c){if(t.handleExitMode&&!i)if("completed"!==n&&"passed"!==n)switch(t.version){case"1.2":e=t.set("cmi.core.exit","suspend");break;case"2004":e=t.set("cmi.exit","suspend")}else switch(t.version){case"1.2":e=t.set("cmi.core.exit","logout");break;case"2004":e=t.set("cmi.exit","normal")}if(e=t.save()){switch(t.version){case"1.2":e=r(c.LMSFinish(""));break;case"2004":e=r(c.Terminate(""))}e?t.connection.isActive=!1:s(a+"failed. \nError code: "+(p=o.getCode())+" \nError info: "+o.getInfo(p))}}else s(a+"failed: API is null.")}else s(a+"aborted: Connection already terminated.");return e},pipwerks.SCORM.data.get=function(e){var t=null,i=pipwerks.SCORM,n=pipwerks.UTILS.trace,s=i.debug,r="SCORM.data.get('"+e+"') ";if(i.connection.isActive){var o=i.API.getHandle(),a=0;if(o){switch(i.version){case"1.2":t=o.LMSGetValue(e);break;case"2004":t=o.GetValue(e)}if(a=s.getCode(),""!==t||0===a)switch(e){case"cmi.core.lesson_status":case"cmi.completion_status":i.data.completionStatus=t;break;case"cmi.core.exit":case"cmi.exit":i.data.exitStatus=t}else n(r+"failed. \nError code: "+a+"\nError info: "+s.getInfo(a))}else n(r+"failed: API is null.")}else n(r+"failed: API connection is inactive.");return n(r+" value: "+t),String(t)},pipwerks.SCORM.data.set=function(e,t){var i=!1,n=pipwerks.SCORM,s=pipwerks.UTILS.trace,r=pipwerks.UTILS.StringToBoolean,o=n.debug,a="SCORM.data.set('"+e+"') ";if(n.connection.isActive){var c=n.API.getHandle(),p=0;if(c){switch(n.version){case"1.2":i=r(c.LMSSetValue(e,t));break;case"2004":i=r(c.SetValue(e,t))}i?"cmi.core.lesson_status"!==e&&"cmi.completion_status"!==e||(n.data.completionStatus=t):s(a+"failed. \nError code: "+(p=o.getCode())+". \nError info: "+o.getInfo(p))}else s(a+"failed: API is null.")}else s(a+"failed: API connection is inactive.");return s(a+" value: "+t),i},pipwerks.SCORM.data.save=function(){var e=!1,t=pipwerks.SCORM,i=pipwerks.UTILS.trace,n=pipwerks.UTILS.StringToBoolean,s="SCORM.data.save failed";if(t.connection.isActive){var r=t.API.getHandle();if(r)switch(t.version){case"1.2":e=n(r.LMSCommit(""));break;case"2004":e=n(r.Commit(""))}else i(s+": API is null.")}else i(s+": API connection is inactive.");return e},pipwerks.SCORM.status=function(e,t){var i=!1,n=pipwerks.SCORM,s=pipwerks.UTILS.trace,r="SCORM.getStatus failed",o="";if(null!==e){switch(n.version){case"1.2":o="cmi.core.lesson_status";break;case"2004":o="cmi.completion_status"}switch(e){case"get":i=n.data.get(o);break;case"set":null!==t?i=n.data.set(o,t):(i=!1,s(r+": status was not specified."));break;default:i=!1,s(r+": no valid action was specified.")}}else s(r+": action was not specified.");return i},pipwerks.SCORM.debug.getCode=function(){var e=pipwerks.SCORM,t=e.API.getHandle(),i=pipwerks.UTILS.trace,n=0;if(t)switch(e.version){case"1.2":n=parseInt(t.LMSGetLastError(),10);break;case"2004":n=parseInt(t.GetLastError(),10)}else i("SCORM.debug.getCode failed: API is null.");return n},pipwerks.SCORM.debug.getInfo=function(e){var t=pipwerks.SCORM,i=t.API.getHandle(),n=pipwerks.UTILS.trace,s="";if(i)switch(t.version){case"1.2":s=i.LMSGetErrorString(e.toString());break;case"2004":s=i.GetErrorString(e.toString())}else n("SCORM.debug.getInfo failed: API is null.");return String(s)},pipwerks.SCORM.debug.getDiagnosticInfo=function(e){var t=pipwerks.SCORM,i=t.API.getHandle(),n=pipwerks.UTILS.trace,s="";if(i)switch(t.version){case"1.2":s=i.LMSGetDiagnostic(e);break;case"2004":s=i.GetDiagnostic(e)}else n("SCORM.debug.getDiagnosticInfo failed: API is null.");return String(s)},pipwerks.SCORM.init=pipwerks.SCORM.connection.initialize,pipwerks.SCORM.get=pipwerks.SCORM.data.get,pipwerks.SCORM.set=pipwerks.SCORM.data.set,pipwerks.SCORM.save=pipwerks.SCORM.data.save,pipwerks.SCORM.quit=pipwerks.SCORM.connection.terminate,pipwerks.UTILS.StringToBoolean=function(e){switch(_typeof(e)){case"object":case"string":return/(true|1)/i.test(e);case"number":return!!e;case"boolean":return e;case"undefined":return null;default:return!1}},pipwerks.UTILS.trace=function(e){pipwerks.debug.isActive&&window.console&&window.console.log&&window.console.log(e)};